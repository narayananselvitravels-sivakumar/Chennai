<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Panel - NST Travels</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    body {
      background: #f4f7fc;
      font-family: 'Segoe UI', sans-serif;
      padding: 40px;
    }
    .panel {
      background: white;
      padding: 30px;
      border-radius: 12px;
      max-width: 600px;
      margin: auto;
      box-shadow: 0 0 15px rgba(0,0,0,0.05);
    }
    .btn-block {
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
  <!-- üîê Login Panel -->
  <div class="panel" id="loginPanel" style="display: none;">
    <h3 class="mb-4 text-center">üîê Admin Login</h3>
    <div class="mb-3">
      <label class="form-label">Username</label>
      <input type="text" id="username" class="form-control" />
    </div>
    <div class="mb-3">
      <label class="form-label">Password</label>
      <input type="password" id="password" class="form-control" />
    </div>
    <button class="btn btn-success w-100" onclick="login()">Login</button>
  </div>

  <!-- ‚úÖ Admin Panel -->
  <div class="panel" id="adminPanel" style="display: none;">
    <h3 class="mb-4 text-center">üîß Admin Panel - NST Travels</h3>
    <button class="btn btn-outline-danger w-100 mb-3" onclick="logout()">üö™ Logout</button>

    <!-- Admin Navigation -->
    <div class="d-grid gap-2">
      <a href="admin-dashboard.html" class="btn btn-primary btn-block">Dashboard</a>
      <a href="attendance.html" class="btn btn-primary btn-block">Attendance</a>
      <a href="driver-dashboard.html" class="btn btn-primary btn-block">Driver Dashboard</a>
      <a href="drivers-vehicles.html" class="btn btn-primary btn-block">Drivers & Vehicles</a>
      <a href="payment-summary.html" class="btn btn-primary btn-block">Payment Summary</a>
      <a href="revenue.html" class="btn btn-primary btn-block">Revenue</a>
      <a href="trip-summary.html" class="btn btn-primary btn-block">Trip Summary</a>
    </div>

    <hr class="my-4" />

    <!-- üîÅ Reset Section -->
    <h5>üõ† Reset Tools</h5>
    <button class="btn btn-warning w-100 mb-3" onclick="resetTripId()">üîÅ Reset Trip ID to #NST001</button>
    <button class="btn btn-danger w-100" onclick="resetAllTrips()">üóëÔ∏è Reset All Trip Data</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, set, remove } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCz2rGDr0iREns6Rg6r1z5EHE3qhLDnEzs",
      authDomain: "narayananselvitravels-26dcb.firebaseapp.com",
      databaseURL: "https://narayananselvitravels-26dcb-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "narayananselvitravels-26dcb",
      storageBucket: "narayananselvitravels-26dcb.appspot.com",
      messagingSenderId: "395599682835",
      appId: "1:395599682835:web:9d46e03ca14aa0738dcee6"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const ADMIN_USERNAME = "Siva";
    const ADMIN_PASSWORD = "Nst@1007";

    // Check login on page load
    window.addEventListener("DOMContentLoaded", () => {
      if (localStorage.getItem("loggedIn") === "true") {
        showAdminPanel();
      } else {
        showLoginPanel();
      }
    });

    function showAdminPanel() {
      document.getElementById("loginPanel").style.display = "none";
      document.getElementById("adminPanel").style.display = "block";
    }

    function showLoginPanel() {
      document.getElementById("loginPanel").style.display = "block";
      document.getElementById("adminPanel").style.display = "none";
    }

    window.login = function () {
      const user = document.getElementById("username").value;
      const pass = document.getElementById("password").value;

      if (user === ADMIN_USERNAME && pass === ADMIN_PASSWORD) {
        localStorage.setItem("loggedIn", "true");
        showAdminPanel();
      } else {
        alert("‚ùå Invalid username or password");
      }
    };

    window.logout = function () {
      localStorage.removeItem("loggedIn");
      showLoginPanel();
    };

    window.resetTripId = async function () {
      await set(ref(db, "tripResetFlag"), true);
      alert("‚úÖ Trip ID reset to #NST001. Refresh trip.html to see the change.");
    };

    window.resetAllTrips = async function () {
      const confirmReset = confirm("‚ö†Ô∏è Are you sure? This will DELETE all trips permanently.");
      if (confirmReset) {
        await remove(ref(db, "trips"));
        await set(ref(db, "tripResetFlag"), true);
        alert("üóëÔ∏è All trips deleted and Trip ID reset.");
      }
    };
  </script>
</body>
</html>